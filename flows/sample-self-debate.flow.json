{
  "$schema": "./schema/flow.schema.json",
  "id": "flow:self-debate",
  "version": "1.0.0",
  "engine": "0.1.0",
  "meta": { "name": "Self Debate" },
  "run": { "concurrency": 1 },
  "nodes": [
    {
      "id": "system",
      "type": "system.prompt",
      "kind": "Prompt",
      "name": "System Prompt",
      "params": { "text": "You are concise." },
      "in": [],
      "out": [{ "port": "out", "types": ["text"] }]
    },
    {
      "id": "userq",
      "type": "system.prompt",
      "kind": "Prompt",
      "name": "User Question",
      "params": { "text": "Debate: Is dropout useful in transformers?" },
      "in": [],
      "out": [{ "port": "out", "types": ["text"] }]
    },
    {
      "id": "planner",
      "type": "llm.generic",
      "kind": "LLM",
      "name": "Planner",
      "params": {
        "adapter": "mock",
        "modelId": "model:llama3-8b.Q4_K_M",
        "temperature": 0.2,
        "maxTokens": 256,
        "runtime": "CPU"
      },
      "llm": {
        "backend": "mock",
        "model": "model:llama3-8b.Q4_K_M",
        "params": { "temperature": 0.2, "runtime": "CPU" },
        "strictSchema": "off",
        "tokenLimits": { "input": 0, "output": 256 }
      },
      "in": [{ "port": "prompt", "types": ["text"] }],
      "out": [{ "port": "completion", "types": ["text"] }]
    },
    {
      "id": "critic",
      "type": "critic",
      "kind": "LLM",
      "name": "Critic",
      "params": {
        "adapter": "mock",
        "modelId": "model:llama3-8b.Q4_K_M",
        "temperature": 0.2,
        "maxTokens": 256,
        "runtime": "CPU"
      },
      "llm": {
        "backend": "mock",
        "model": "model:llama3-8b.Q4_K_M",
        "params": { "temperature": 0.2, "runtime": "CPU" },
        "strictSchema": "off",
        "tokenLimits": { "input": 0, "output": 256 }
      },
      "in": [{ "port": "text", "types": ["text"] }],
      "out": [{ "port": "notes", "types": ["text"] }]
    },
    {
      "id": "loop",
      "type": "loop",
      "kind": "Router",
      "name": "Loop",
      "params": { "maxIters": 3, "stopOn": "DONE" },
      "in": [{ "port": "in", "types": ["text"] }],
      "out": [{ "port": "body", "types": ["text"] }, { "port": "out", "types": ["text"] }]
    },
    {
      "id": "output",
      "type": "output",
      "kind": "UI",
      "name": "Output",
      "params": {},
      "in": [{ "port": "in", "types": ["text"] }],
      "out": []
    }
  ],
  "edges": [
    { "id": "e1", "from": ["system", "out"], "to": ["planner", "prompt"], "label": "sys", "direction": "forward", "edgeType": "data" },
    { "id": "e2", "from": ["userq", "out"], "to": ["planner", "prompt"], "label": "q", "direction": "forward", "edgeType": "data" },
    { "id": "e3", "from": ["planner", "completion"], "to": ["critic", "text"], "label": "review", "direction": "forward", "edgeType": "data" },
    { "id": "e4", "from": ["critic", "notes"], "to": ["loop", "in"], "label": "iterate", "direction": "forward", "edgeType": "data" },
    { "id": "e5", "from": ["loop", "body"], "to": ["planner", "prompt"], "label": "feedback", "direction": "forward", "edgeType": "data" },
    { "id": "e6", "from": ["loop", "out"], "to": ["output", "in"], "label": "final", "direction": "forward", "edgeType": "data" }
  ],
  "prompts": { "packs": [] },
  "models": { "registryRef": "../models/models.json" },
  "profiles": { "default": { "concurrency": 2 } }
}

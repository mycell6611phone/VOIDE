(function(){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),o=0,i=2,n=!0;i<arguments.length;)r[o++]=arguments[i++];return new Promise(function(u,f){r[o]=function(l){if(n)if(n=!1,l)f(l);else{for(var d=new Array(arguments.length-1),c=0;c<d.length;)d[c++]=arguments[c];u.apply(null,d)}};try{e.apply(t||null,r)}catch(a){n&&(n=!1,f(a))}})}var base64$1={};(function(e){var t=e;t.length=function(u){var f=u.length;if(!f)return 0;for(var a=0;--f%4>1&&u.charAt(f)==="=";)++a;return Math.ceil(u.length*3)/4-a};for(var r=new Array(64),o=new Array(123),i=0;i<64;)o[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;t.encode=function(u,f,a){for(var l=null,d=[],c=0,p=0,h;f<a;){var y=u[f++];switch(p){case 0:d[c++]=r[y>>2],h=(y&3)<<4,p=1;break;case 1:d[c++]=r[h|y>>4],h=(y&15)<<2,p=2;break;case 2:d[c++]=r[h|y>>6],d[c++]=r[y&63],p=0;break}c>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,d)),c=0)}return p&&(d[c++]=r[h],d[c++]=61,p===1&&(d[c++]=61)),l?(c&&l.push(String.fromCharCode.apply(String,d.slice(0,c))),l.join("")):String.fromCharCode.apply(String,d.slice(0,c))};var n="invalid encoding";t.decode=function(u,f,a){for(var l=a,d=0,c,p=0;p<u.length;){var h=u.charCodeAt(p++);if(h===61&&d>1)break;if((h=o[h])===void 0)throw Error(n);switch(d){case 0:c=h,d=1;break;case 1:f[a++]=c<<2|(h&48)>>4,c=h,d=2;break;case 2:f[a++]=(c&15)<<4|(h&60)>>2,c=h,d=3;break;case 3:f[a++]=(c&3)<<6|h,d=0;break}}if(d===1)throw Error(n);return a-l},t.test=function(u){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(u)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(t,r,o){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:r,ctx:o||this}),this},EventEmitter.prototype.off=function(t,r){if(t===void 0)this._listeners={};else if(r===void 0)this._listeners[t]=[];else for(var o=this._listeners[t],i=0;i<o.length;)o[i].fn===r?o.splice(i,1):++i;return this},EventEmitter.prototype.emit=function(t){var r=this._listeners[t];if(r){for(var o=[],i=1;i<arguments.length;)o.push(arguments[i++]);for(i=0;i<r.length;)r[i].fn.apply(r[i++].ctx,o)}return this};var float=factory(factory);function factory(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),o=r[3]===128;function i(f,a,l){t[0]=f,a[l]=r[0],a[l+1]=r[1],a[l+2]=r[2],a[l+3]=r[3]}function n(f,a,l){t[0]=f,a[l]=r[3],a[l+1]=r[2],a[l+2]=r[1],a[l+3]=r[0]}e.writeFloatLE=o?i:n,e.writeFloatBE=o?n:i;function s(f,a){return r[0]=f[a],r[1]=f[a+1],r[2]=f[a+2],r[3]=f[a+3],t[0]}function u(f,a){return r[3]=f[a],r[2]=f[a+1],r[1]=f[a+2],r[0]=f[a+3],t[0]}e.readFloatLE=o?s:u,e.readFloatBE=o?u:s}():function(){function t(o,i,n,s){var u=i<0?1:0;if(u&&(i=-i),i===0)o(1/i>0?0:2147483648,n,s);else if(isNaN(i))o(2143289344,n,s);else if(i>34028234663852886e22)o((u<<31|2139095040)>>>0,n,s);else if(i<11754943508222875e-54)o((u<<31|Math.round(i/1401298464324817e-60))>>>0,n,s);else{var f=Math.floor(Math.log(i)/Math.LN2),a=Math.round(i*Math.pow(2,-f)*8388608)&8388607;o((u<<31|f+127<<23|a)>>>0,n,s)}}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE);function r(o,i,n){var s=o(i,n),u=(s>>31)*2+1,f=s>>>23&255,a=s&8388607;return f===255?a?NaN:u*(1/0):f===0?u*1401298464324817e-60*a:u*Math.pow(2,f-150)*(a+8388608)}e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),o=r[7]===128;function i(f,a,l){t[0]=f,a[l]=r[0],a[l+1]=r[1],a[l+2]=r[2],a[l+3]=r[3],a[l+4]=r[4],a[l+5]=r[5],a[l+6]=r[6],a[l+7]=r[7]}function n(f,a,l){t[0]=f,a[l]=r[7],a[l+1]=r[6],a[l+2]=r[5],a[l+3]=r[4],a[l+4]=r[3],a[l+5]=r[2],a[l+6]=r[1],a[l+7]=r[0]}e.writeDoubleLE=o?i:n,e.writeDoubleBE=o?n:i;function s(f,a){return r[0]=f[a],r[1]=f[a+1],r[2]=f[a+2],r[3]=f[a+3],r[4]=f[a+4],r[5]=f[a+5],r[6]=f[a+6],r[7]=f[a+7],t[0]}function u(f,a){return r[7]=f[a],r[6]=f[a+1],r[5]=f[a+2],r[4]=f[a+3],r[3]=f[a+4],r[2]=f[a+5],r[1]=f[a+6],r[0]=f[a+7],t[0]}e.readDoubleLE=o?s:u,e.readDoubleBE=o?u:s}():function(){function t(o,i,n,s,u,f){var a=s<0?1:0;if(a&&(s=-s),s===0)o(0,u,f+i),o(1/s>0?0:2147483648,u,f+n);else if(isNaN(s))o(0,u,f+i),o(2146959360,u,f+n);else if(s>17976931348623157e292)o(0,u,f+i),o((a<<31|2146435072)>>>0,u,f+n);else{var l;if(s<22250738585072014e-324)l=s/5e-324,o(l>>>0,u,f+i),o((a<<31|l/4294967296)>>>0,u,f+n);else{var d=Math.floor(Math.log(s)/Math.LN2);d===1024&&(d=1023),l=s*Math.pow(2,-d),o(l*4503599627370496>>>0,u,f+i),o((a<<31|d+1023<<20|l*1048576&1048575)>>>0,u,f+n)}}}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0);function r(o,i,n,s,u){var f=o(s,u+i),a=o(s,u+n),l=(a>>31)*2+1,d=a>>>20&2047,c=4294967296*(a&1048575)+f;return d===2047?c?NaN:l*(1/0):d===0?l*5e-324*c:l*Math.pow(2,d-1075)*(c+4503599627370496)}e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=e&255}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};(function(e){var t=e;t.length=function(o){for(var i=0,n=0,s=0;s<o.length;++s)n=o.charCodeAt(s),n<128?i+=1:n<2048?i+=2:(n&64512)===55296&&(o.charCodeAt(s+1)&64512)===56320?(++s,i+=4):i+=3;return i},t.read=function(o,i,n){var s=n-i;if(s<1)return"";for(var u=null,f=[],a=0,l;i<n;)l=o[i++],l<128?f[a++]=l:l>191&&l<224?f[a++]=(l&31)<<6|o[i++]&63:l>239&&l<365?(l=((l&7)<<18|(o[i++]&63)<<12|(o[i++]&63)<<6|o[i++]&63)-65536,f[a++]=55296+(l>>10),f[a++]=56320+(l&1023)):f[a++]=(l&15)<<12|(o[i++]&63)<<6|o[i++]&63,a>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,f)),a=0);return u?(a&&u.push(String.fromCharCode.apply(String,f.slice(0,a))),u.join("")):String.fromCharCode.apply(String,f.slice(0,a))},t.write=function(o,i,n){for(var s=n,u,f,a=0;a<o.length;++a)u=o.charCodeAt(a),u<128?i[n++]=u:u<2048?(i[n++]=u>>6|192,i[n++]=u&63|128):(u&64512)===55296&&((f=o.charCodeAt(a+1))&64512)===56320?(u=65536+((u&1023)<<10)+(f&1023),++a,i[n++]=u>>18|240,i[n++]=u>>12&63|128,i[n++]=u>>6&63|128,i[n++]=u&63|128):(i[n++]=u>>12|224,i[n++]=u>>6&63|128,i[n++]=u&63|128);return n-s}})(utf8$2);var pool_1=pool;function pool(e,t,r){var o=r||8192,i=o>>>1,n=null,s=o;return function(f){if(f<1||f>i)return e(f);s+f>o&&(n=e(o),s=0);var a=t.call(n,s,s+=f);return s&7&&(s=(s|7)+1),a}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(n,s){this.lo=n>>>0,this.hi=s>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var o=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(s){if(s===0)return r;var u=s<0;u&&(s=-s);var f=s>>>0,a=(s-f)/4294967296>>>0;return u&&(a=~a>>>0,f=~f>>>0,++f>4294967295&&(f=0,++a>4294967295&&(a=0))),new t(f,a)},t.from=function(s){if(typeof s=="number")return t.fromNumber(s);if(e.isString(s))if(e.Long)s=e.Long.fromString(s);else return t.fromNumber(parseInt(s,10));return s.low||s.high?new t(s.low>>>0,s.high>>>0):r},t.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var u=~this.lo+1>>>0,f=~this.hi>>>0;return u||(f=f+1>>>0),-(u+f*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(s){return e.Long?new e.Long(this.lo|0,this.hi|0,!!s):{low:this.lo|0,high:this.hi|0,unsigned:!!s}};var i=String.prototype.charCodeAt;return t.fromHash=function(s){return s===o?r:new t((i.call(s,0)|i.call(s,1)<<8|i.call(s,2)<<16|i.call(s,3)<<24)>>>0,(i.call(s,4)|i.call(s,5)<<8|i.call(s,6)<<16|i.call(s,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},t.prototype.zzDecode=function(){var s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},t.prototype.length=function(){var s=this.lo,u=(this.lo>>>28|this.hi<<4)>>>0,f=this.hi>>>24;return f===0?u===0?s<16384?s<128?1:2:s<2097152?3:4:u<16384?u<128?5:6:u<2097152?7:8:f<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n},t.isString=function(n){return typeof n=="string"||n instanceof String},t.isObject=function(n){return n&&typeof n=="object"},t.isset=t.isSet=function(n,s){var u=n[s];return u!=null&&n.hasOwnProperty(s)?typeof u!="object"||(Array.isArray(u)?u.length:Object.keys(u).length)>0:!1},t.Buffer=function(){try{var i=t.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(n){return typeof n=="number"?t.Buffer?t._Buffer_allocUnsafe(n):new t.Array(n):t.Buffer?t._Buffer_from(n):typeof Uint8Array>"u"?n:new Uint8Array(n)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(n){return n?t.LongBits.from(n).toHash():t.LongBits.zeroHash},t.longFromHash=function(n,s){var u=t.LongBits.fromHash(n);return t.Long?t.Long.fromBits(u.lo,u.hi,s):u.toNumber(!!s)};function r(i,n,s){for(var u=Object.keys(n),f=0;f<u.length;++f)(i[u[f]]===void 0||!s)&&(i[u[f]]=n[u[f]]);return i}t.merge=r,t.lcFirst=function(n){return n.charAt(0).toLowerCase()+n.substring(1)};function o(i){function n(s,u){if(!(this instanceof n))return new n(s,u);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:new Error().stack||""}),u&&r(this,u)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return i},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}t.newError=o,t.ProtocolError=o("ProtocolError"),t.oneOfGetter=function(n){for(var s={},u=0;u<n.length;++u)s[n[u]]=1;return function(){for(var f=Object.keys(this),a=f.length-1;a>-1;--a)if(s[f[a]]===1&&this[f[a]]!==void 0&&this[f[a]]!==null)return f[a]}},t.oneOfSetter=function(n){return function(s){for(var u=0;u<n.length;++u)n[u]!==s&&delete this[n[u]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var i=t.Buffer;if(!i){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=i.from!==Uint8Array.from&&i.from||function(s,u){return new i(s,u)},t._Buffer_allocUnsafe=i.allocUnsafe||function(s){return new i(s)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function e(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1(),Writer$1.alloc=function e(t){return new util$4.Array(t)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function e(t,r,o){return this.tail=this.tail.next=new Op(t,r,o),this.len+=r,this};function writeByte(e,t,r){t[r]=e&255}function writeVarint32(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function e(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},Writer$1.prototype.int32=function e(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)},Writer$1.prototype.sint32=function e(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(e,t,r){for(;e.hi;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}Writer$1.prototype.uint64=function e(t){var r=LongBits$1.from(t);return this._push(writeVarint64,r.length(),r)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function e(t){var r=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,r.length(),r)},Writer$1.prototype.bool=function e(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.prototype.fixed32=function e(t){return this._push(writeFixed32,4,t>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function e(t){var r=LongBits$1.from(t);return this._push(writeFixed32,4,r.lo)._push(writeFixed32,4,r.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function e(t){return this._push(util$4.float.writeFloatLE,4,t)},Writer$1.prototype.double=function e(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function e(t,r,o){r.set(t,o)}:function e(t,r,o){for(var i=0;i<t.length;++i)r[o+i]=t[i]};Writer$1.prototype.bytes=function e(t){var r=t.length>>>0;if(!r)return this._push(writeByte,1,0);if(util$4.isString(t)){var o=Writer$1.alloc(r=base64.length(t));base64.decode(t,o,0),t=o}return this.uint32(r)._push(writeBytes,r,t)},Writer$1.prototype.string=function e(t){var r=utf8$1.length(t);return r?this.uint32(r)._push(utf8$1.write,r,t):this._push(writeByte,1,0)},Writer$1.prototype.fork=function e(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function e(){var t=this.head,r=this.tail,o=this.len;return this.reset().uint32(o),o&&(this.tail.next=t.next,this.tail=r,this.len+=o),this},Writer$1.prototype.finish=function e(){for(var t=this.head.next,r=this.constructor.alloc(this.len),o=0;t;)t.fn(t.val,r,o),o+=t.len,t=t.next;return r},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,r,o){r.set(t,o)}:function(t,r,o){if(t.copy)t.copy(r,o,0,t.length);else for(var i=0;i<t.length;)r[o++]=t[i++]}},BufferWriter.prototype.bytes=function e(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this._push(BufferWriter.writeBytesBuffer,r,t),this};function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter.prototype.string=function e(t){var r=util$3.Buffer.byteLength(t);return this.uint32(r),r&&this._push(writeStringBuffer,r,t),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function e(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function e(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function e(){return util$2.Buffer?function(r){return(Reader$1.create=function(i){return util$2.Buffer.isBuffer(i)?new BufferReader$1(i):create_array(i)})(r)}:create_array};Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=function e(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}(),Reader$1.prototype.int32=function e(){return this.uint32()|0},Reader$1.prototype.sint32=function e(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var e=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Reader$1.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Reader$1.prototype.bytes=function e(){var t=this.uint32(),r=this.pos,o=this.pos+t;if(o>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(r,o);if(r===o){var i=util$2.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,o)},Reader$1.prototype.string=function e(){var t=this.bytes();return utf8.read(t,0,t.length)},Reader$1.prototype.skip=function e(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function e(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(e,t,r){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}Service.prototype.rpcCall=function e(t,r,o,i,n){if(!i)throw TypeError("request must be specified");var s=this;if(!n)return util.asPromise(e,s,t,r,o,i);if(!s.rpcImpl){setTimeout(function(){n(Error("already ended"))},0);return}try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(f,a){if(f)return s.emit("error",f,t),n(f);if(a===null){s.end(!0);return}if(!(a instanceof o))try{a=o[s.responseDelimited?"decodeDelimited":"decode"](a)}catch(l){return s.emit("error",l,t),n(l)}return s.emit("data",a,t),n(null,a)})}catch(u){s.emit("error",u,t),setTimeout(function(){n(u)},0);return}},Service.prototype.end=function e(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){var t=e;t.Service=service}(rpc);var roots={};(function(e){var t=e;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=r;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}r()})(indexMinimal);var minimal=indexMinimal,_m0=getDefaultExportFromCjs(minimal);function createBasePort(){return{port:"",types:[]}}const Port={encode(e,t=_m0.Writer.create()){e.port!==""&&t.uint32(10).string(e.port);for(const r of e.types)t.uint32(18).string(r);return t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const i=createBasePort();for(;r.pos<o;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.port=r.string();continue;case 2:if(n!==18)break;i.types.push(r.string());continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{port:isSet(e.port)?globalThis.String(e.port):"",types:globalThis.Array.isArray(e==null?void 0:e.types)?e.types.map(t=>globalThis.String(t)):[]}},toJSON(e){var r;const t={};return e.port!==""&&(t.port=e.port),(r=e.types)!=null&&r.length&&(t.types=e.types),t},create(e){return Port.fromPartial(e??{})},fromPartial(e){var r;const t=createBasePort();return t.port=e.port??"",t.types=((r=e.types)==null?void 0:r.map(o=>o))||[],t}};function createBaseNodePort(){return{node:"",port:""}}const NodePort={encode(e,t=_m0.Writer.create()){return e.node!==""&&t.uint32(10).string(e.node),e.port!==""&&t.uint32(18).string(e.port),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const i=createBaseNodePort();for(;r.pos<o;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.node=r.string();continue;case 2:if(n!==18)break;i.port=r.string();continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{node:isSet(e.node)?globalThis.String(e.node):"",port:isSet(e.port)?globalThis.String(e.port):""}},toJSON(e){const t={};return e.node!==""&&(t.node=e.node),e.port!==""&&(t.port=e.port),t},create(e){return NodePort.fromPartial(e??{})},fromPartial(e){const t=createBaseNodePort();return t.node=e.node??"",t.port=e.port??"",t}};function createBaseNode(){return{id:"",type:"",name:"",paramsJson:"",in:[],out:[]}}const Node={encode(e,t=_m0.Writer.create()){e.id!==""&&t.uint32(10).string(e.id),e.type!==""&&t.uint32(18).string(e.type),e.name!==""&&t.uint32(26).string(e.name),e.paramsJson!==""&&t.uint32(34).string(e.paramsJson);for(const r of e.in)Port.encode(r,t.uint32(42).fork()).ldelim();for(const r of e.out)Port.encode(r,t.uint32(50).fork()).ldelim();return t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const i=createBaseNode();for(;r.pos<o;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.id=r.string();continue;case 2:if(n!==18)break;i.type=r.string();continue;case 3:if(n!==26)break;i.name=r.string();continue;case 4:if(n!==34)break;i.paramsJson=r.string();continue;case 5:if(n!==42)break;i.in.push(Port.decode(r,r.uint32()));continue;case 6:if(n!==50)break;i.out.push(Port.decode(r,r.uint32()));continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{id:isSet(e.id)?globalThis.String(e.id):"",type:isSet(e.type)?globalThis.String(e.type):"",name:isSet(e.name)?globalThis.String(e.name):"",paramsJson:isSet(e.paramsJson)?globalThis.String(e.paramsJson):"",in:globalThis.Array.isArray(e==null?void 0:e.in)?e.in.map(t=>Port.fromJSON(t)):[],out:globalThis.Array.isArray(e==null?void 0:e.out)?e.out.map(t=>Port.fromJSON(t)):[]}},toJSON(e){var r,o;const t={};return e.id!==""&&(t.id=e.id),e.type!==""&&(t.type=e.type),e.name!==""&&(t.name=e.name),e.paramsJson!==""&&(t.paramsJson=e.paramsJson),(r=e.in)!=null&&r.length&&(t.in=e.in.map(i=>Port.toJSON(i))),(o=e.out)!=null&&o.length&&(t.out=e.out.map(i=>Port.toJSON(i))),t},create(e){return Node.fromPartial(e??{})},fromPartial(e){var r,o;const t=createBaseNode();return t.id=e.id??"",t.type=e.type??"",t.name=e.name??"",t.paramsJson=e.paramsJson??"",t.in=((r=e.in)==null?void 0:r.map(i=>Port.fromPartial(i)))||[],t.out=((o=e.out)==null?void 0:o.map(i=>Port.fromPartial(i)))||[],t}};function createBaseEdge(){return{id:"",from:void 0,to:void 0,label:"",type:""}}const Edge={encode(e,t=_m0.Writer.create()){return e.id!==""&&t.uint32(10).string(e.id),e.from!==void 0&&NodePort.encode(e.from,t.uint32(18).fork()).ldelim(),e.to!==void 0&&NodePort.encode(e.to,t.uint32(26).fork()).ldelim(),e.label!==""&&t.uint32(34).string(e.label),e.type!==""&&t.uint32(42).string(e.type),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const i=createBaseEdge();for(;r.pos<o;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.id=r.string();continue;case 2:if(n!==18)break;i.from=NodePort.decode(r,r.uint32());continue;case 3:if(n!==26)break;i.to=NodePort.decode(r,r.uint32());continue;case 4:if(n!==34)break;i.label=r.string();continue;case 5:if(n!==42)break;i.type=r.string();continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{id:isSet(e.id)?globalThis.String(e.id):"",from:isSet(e.from)?NodePort.fromJSON(e.from):void 0,to:isSet(e.to)?NodePort.fromJSON(e.to):void 0,label:isSet(e.label)?globalThis.String(e.label):"",type:isSet(e.type)?globalThis.String(e.type):""}},toJSON(e){const t={};return e.id!==""&&(t.id=e.id),e.from!==void 0&&(t.from=NodePort.toJSON(e.from)),e.to!==void 0&&(t.to=NodePort.toJSON(e.to)),e.label!==""&&(t.label=e.label),e.type!==""&&(t.type=e.type),t},create(e){return Edge.fromPartial(e??{})},fromPartial(e){const t=createBaseEdge();return t.id=e.id??"",t.from=e.from!==void 0&&e.from!==null?NodePort.fromPartial(e.from):void 0,t.to=e.to!==void 0&&e.to!==null?NodePort.fromPartial(e.to):void 0,t.label=e.label??"",t.type=e.type??"",t}};function createBaseFlow(){return{id:"",version:"",nodes:[],edges:[]}}const Flow={encode(e,t=_m0.Writer.create()){e.id!==""&&t.uint32(10).string(e.id),e.version!==""&&t.uint32(18).string(e.version);for(const r of e.nodes)Node.encode(r,t.uint32(26).fork()).ldelim();for(const r of e.edges)Edge.encode(r,t.uint32(34).fork()).ldelim();return t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const i=createBaseFlow();for(;r.pos<o;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.id=r.string();continue;case 2:if(n!==18)break;i.version=r.string();continue;case 3:if(n!==26)break;i.nodes.push(Node.decode(r,r.uint32()));continue;case 4:if(n!==34)break;i.edges.push(Edge.decode(r,r.uint32()));continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{id:isSet(e.id)?globalThis.String(e.id):"",version:isSet(e.version)?globalThis.String(e.version):"",nodes:globalThis.Array.isArray(e==null?void 0:e.nodes)?e.nodes.map(t=>Node.fromJSON(t)):[],edges:globalThis.Array.isArray(e==null?void 0:e.edges)?e.edges.map(t=>Edge.fromJSON(t)):[]}},toJSON(e){var r,o;const t={};return e.id!==""&&(t.id=e.id),e.version!==""&&(t.version=e.version),(r=e.nodes)!=null&&r.length&&(t.nodes=e.nodes.map(i=>Node.toJSON(i))),(o=e.edges)!=null&&o.length&&(t.edges=e.edges.map(i=>Edge.toJSON(i))),t},create(e){return Flow.fromPartial(e??{})},fromPartial(e){var r,o;const t=createBaseFlow();return t.id=e.id??"",t.version=e.version??"",t.nodes=((r=e.nodes)==null?void 0:r.map(i=>Node.fromPartial(i)))||[],t.edges=((o=e.edges)==null?void 0:o.map(i=>Edge.fromPartial(i)))||[],t}};function isSet(e){return e!=null}class BuildError extends Error{constructor(t,r,o,i){super(r),this.code=t,this.node=o,this.port=i}}function findNode(e,t){return e.nodes.find(r=>r.id===t)}function findPort(e,t,r){return(t==="in"?e.in:e.out).find(i=>i.port===r)}function validateMenus(e){for(const t of e.nodes)if(!Array.isArray(t.in)||!Array.isArray(t.out))throw new BuildError("E-CONFIG",`menus missing for node ${t.id}`,t.id)}function validateDangling(e){for(const t of e.edges){const[r,o]=t.from,[i,n]=t.to,s=findNode(e,r);if(!s)throw new BuildError("E-DANGLING",`missing node ${r}`,r);if(!findPort(s,"out",o))throw new BuildError("E-DANGLING",`missing port ${r}.${o}`,r,o);const f=findNode(e,i);if(!f)throw new BuildError("E-DANGLING",`missing node ${i}`,i);if(!findPort(f,"in",n))throw new BuildError("E-DANGLING",`missing port ${i}.${n}`,i,n)}}function validateTypes(e){for(const t of e.edges){const r=findNode(e,t.from[0]),o=findNode(e,t.to[0]),i=findPort(r,"out",t.from[1]),n=findPort(o,"in",t.to[1]);if(i.types.filter(u=>n.types.includes(u)).length===0)throw new BuildError("E-TYPE",`type mismatch ${t.from.join(".")} -> ${t.to.join(".")}`,t.from[0],t.from[1])}}function validateAcyclic(e){const t=new Map;for(const n of e.edges){const s=t.get(n.from[0])??[];s.push(n.to[0]),t.set(n.from[0],s)}const r=new Set,o=new Set;function i(n){if(o.has(n))throw new BuildError("E-CYCLE",`cycle detected at ${n}`,n);if(!r.has(n)){o.add(n);for(const s of t.get(n)??[])i(s);o.delete(n),r.add(n)}}for(const n of e.nodes)i(n.id)}function validateReachableOutputs(e){const t=new Set;for(const r of e.edges)t.add(`${r.from[0]}.${r.from[1]}`);for(const r of e.nodes)if(r.type!=="output")for(const o of r.out){const i=`${r.id}.${o.port}`;if(!t.has(i))throw new BuildError("E-UNREACHABLE-OUTPUT",`unreachable output ${i}`,r.id,o.port)}}function validateCanvas(e){validateMenus(e),validateDangling(e),validateTypes(e),validateAcyclic(e),validateReachableOutputs(e)}function getPort(e,t,r){return findPort(e,t,r)}function compile(e){const t={nodes:e.nodes.map(o=>({id:o.id,type:o.type,in:o.in,out:o.out})),edges:e.edges.map(o=>({from:o.from,to:o.to}))};validateCanvas(t);const r={id:e.id,version:e.version,nodes:e.nodes.map(o=>({id:o.id,type:o.type,name:o.name??"",paramsJson:JSON.stringify(o.params??{}),in:o.in.map(i=>({port:i.port,types:[...i.types]})),out:o.out.map(i=>({port:i.port,types:[...i.types]}))})),edges:e.edges.map(o=>{const i=t.nodes.find(a=>a.id===o.from[0]),n=t.nodes.find(a=>a.id===o.to[0]),s=getPort(i,"out",o.from[1]),u=getPort(n,"in",o.to[1]),f=s.types.find(a=>u.types.includes(a));if(!f)throw new BuildError("E-TYPE",`type mismatch ${o.from.join(".")} -> ${o.to.join(".")}`,o.from[0],o.from[1]);return{id:o.id??"",from:{node:o.from[0],port:o.from[1]},to:{node:o.to[0],port:o.to[1]},label:o.label??"",type:f}})};return Flow.encode(r).finish()}self.onmessage=e=>{try{const t=compile(e.data);self.postMessage({type:"success",bin:t},[t.buffer])}catch(t){self.postMessage({type:"error",message:t.message})}}})();

(function(){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),s=0,i=2,n=!0;i<arguments.length;)r[s++]=arguments[i++];return new Promise(function(a,f){r[s]=function(l){if(n)if(n=!1,l)f(l);else{for(var c=new Array(arguments.length-1),h=0;h<c.length;)c[h++]=arguments[h];a.apply(null,c)}};try{e.apply(t||null,r)}catch(u){n&&(n=!1,f(u))}})}var base64$1={};(function(e){var t=e;t.length=function(a){var f=a.length;if(!f)return 0;for(var u=0;--f%4>1&&a.charAt(f)==="=";)++u;return Math.ceil(a.length*3)/4-u};for(var r=new Array(64),s=new Array(123),i=0;i<64;)s[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;t.encode=function(a,f,u){for(var l=null,c=[],h=0,p=0,d;f<u;){var g=a[f++];switch(p){case 0:c[h++]=r[g>>2],d=(g&3)<<4,p=1;break;case 1:c[h++]=r[d|g>>4],d=(g&15)<<2,p=2;break;case 2:c[h++]=r[d|g>>6],c[h++]=r[g&63],p=0;break}h>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,c)),h=0)}return p&&(c[h++]=r[d],c[h++]=61,p===1&&(c[h++]=61)),l?(h&&l.push(String.fromCharCode.apply(String,c.slice(0,h))),l.join("")):String.fromCharCode.apply(String,c.slice(0,h))};var n="invalid encoding";t.decode=function(a,f,u){for(var l=u,c=0,h,p=0;p<a.length;){var d=a.charCodeAt(p++);if(d===61&&c>1)break;if((d=s[d])===void 0)throw Error(n);switch(c){case 0:h=d,c=1;break;case 1:f[u++]=h<<2|(d&48)>>4,h=d,c=2;break;case 2:f[u++]=(h&15)<<4|(d&60)>>2,h=d,c=3;break;case 3:f[u++]=(h&3)<<6|d,c=0;break}}if(c===1)throw Error(n);return u-l},t.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(t,r,s){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:r,ctx:s||this}),this},EventEmitter.prototype.off=function(t,r){if(t===void 0)this._listeners={};else if(r===void 0)this._listeners[t]=[];else for(var s=this._listeners[t],i=0;i<s.length;)s[i].fn===r?s.splice(i,1):++i;return this},EventEmitter.prototype.emit=function(t){var r=this._listeners[t];if(r){for(var s=[],i=1;i<arguments.length;)s.push(arguments[i++]);for(i=0;i<r.length;)r[i].fn.apply(r[i++].ctx,s)}return this};var float=factory(factory);function factory(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),s=r[3]===128;function i(f,u,l){t[0]=f,u[l]=r[0],u[l+1]=r[1],u[l+2]=r[2],u[l+3]=r[3]}function n(f,u,l){t[0]=f,u[l]=r[3],u[l+1]=r[2],u[l+2]=r[1],u[l+3]=r[0]}e.writeFloatLE=s?i:n,e.writeFloatBE=s?n:i;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],t[0]}function a(f,u){return r[3]=f[u],r[2]=f[u+1],r[1]=f[u+2],r[0]=f[u+3],t[0]}e.readFloatLE=s?o:a,e.readFloatBE=s?a:o}():function(){function t(s,i,n,o){var a=i<0?1:0;if(a&&(i=-i),i===0)s(1/i>0?0:2147483648,n,o);else if(isNaN(i))s(2143289344,n,o);else if(i>34028234663852886e22)s((a<<31|2139095040)>>>0,n,o);else if(i<11754943508222875e-54)s((a<<31|Math.round(i/1401298464324817e-60))>>>0,n,o);else{var f=Math.floor(Math.log(i)/Math.LN2),u=Math.round(i*Math.pow(2,-f)*8388608)&8388607;s((a<<31|f+127<<23|u)>>>0,n,o)}}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE);function r(s,i,n){var o=s(i,n),a=(o>>31)*2+1,f=o>>>23&255,u=o&8388607;return f===255?u?NaN:a*(1/0):f===0?a*1401298464324817e-60*u:a*Math.pow(2,f-150)*(u+8388608)}e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),s=r[7]===128;function i(f,u,l){t[0]=f,u[l]=r[0],u[l+1]=r[1],u[l+2]=r[2],u[l+3]=r[3],u[l+4]=r[4],u[l+5]=r[5],u[l+6]=r[6],u[l+7]=r[7]}function n(f,u,l){t[0]=f,u[l]=r[7],u[l+1]=r[6],u[l+2]=r[5],u[l+3]=r[4],u[l+4]=r[3],u[l+5]=r[2],u[l+6]=r[1],u[l+7]=r[0]}e.writeDoubleLE=s?i:n,e.writeDoubleBE=s?n:i;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],r[4]=f[u+4],r[5]=f[u+5],r[6]=f[u+6],r[7]=f[u+7],t[0]}function a(f,u){return r[7]=f[u],r[6]=f[u+1],r[5]=f[u+2],r[4]=f[u+3],r[3]=f[u+4],r[2]=f[u+5],r[1]=f[u+6],r[0]=f[u+7],t[0]}e.readDoubleLE=s?o:a,e.readDoubleBE=s?a:o}():function(){function t(s,i,n,o,a,f){var u=o<0?1:0;if(u&&(o=-o),o===0)s(0,a,f+i),s(1/o>0?0:2147483648,a,f+n);else if(isNaN(o))s(0,a,f+i),s(2146959360,a,f+n);else if(o>17976931348623157e292)s(0,a,f+i),s((u<<31|2146435072)>>>0,a,f+n);else{var l;if(o<22250738585072014e-324)l=o/5e-324,s(l>>>0,a,f+i),s((u<<31|l/4294967296)>>>0,a,f+n);else{var c=Math.floor(Math.log(o)/Math.LN2);c===1024&&(c=1023),l=o*Math.pow(2,-c),s(l*4503599627370496>>>0,a,f+i),s((u<<31|c+1023<<20|l*1048576&1048575)>>>0,a,f+n)}}}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0);function r(s,i,n,o,a){var f=s(o,a+i),u=s(o,a+n),l=(u>>31)*2+1,c=u>>>20&2047,h=4294967296*(u&1048575)+f;return c===2047?h?NaN:l*(1/0):c===0?l*5e-324*h:l*Math.pow(2,c-1075)*(h+4503599627370496)}e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=e&255}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};(function(e){var t=e;t.length=function(s){for(var i=0,n=0,o=0;o<s.length;++o)n=s.charCodeAt(o),n<128?i+=1:n<2048?i+=2:(n&64512)===55296&&(s.charCodeAt(o+1)&64512)===56320?(++o,i+=4):i+=3;return i},t.read=function(s,i,n){var o=n-i;if(o<1)return"";for(var a=null,f=[],u=0,l;i<n;)l=s[i++],l<128?f[u++]=l:l>191&&l<224?f[u++]=(l&31)<<6|s[i++]&63:l>239&&l<365?(l=((l&7)<<18|(s[i++]&63)<<12|(s[i++]&63)<<6|s[i++]&63)-65536,f[u++]=55296+(l>>10),f[u++]=56320+(l&1023)):f[u++]=(l&15)<<12|(s[i++]&63)<<6|s[i++]&63,u>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,f)),u=0);return a?(u&&a.push(String.fromCharCode.apply(String,f.slice(0,u))),a.join("")):String.fromCharCode.apply(String,f.slice(0,u))},t.write=function(s,i,n){for(var o=n,a,f,u=0;u<s.length;++u)a=s.charCodeAt(u),a<128?i[n++]=a:a<2048?(i[n++]=a>>6|192,i[n++]=a&63|128):(a&64512)===55296&&((f=s.charCodeAt(u+1))&64512)===56320?(a=65536+((a&1023)<<10)+(f&1023),++u,i[n++]=a>>18|240,i[n++]=a>>12&63|128,i[n++]=a>>6&63|128,i[n++]=a&63|128):(i[n++]=a>>12|224,i[n++]=a>>6&63|128,i[n++]=a&63|128);return n-o}})(utf8$2);var pool_1=pool;function pool(e,t,r){var s=r||8192,i=s>>>1,n=null,o=s;return function(f){if(f<1||f>i)return e(f);o+f>s&&(n=e(s),o=0);var u=t.call(n,o,o+=f);return o&7&&(o=(o|7)+1),u}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(n,o){this.lo=n>>>0,this.hi=o>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var s=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(o){if(o===0)return r;var a=o<0;a&&(o=-o);var f=o>>>0,u=(o-f)/4294967296>>>0;return a&&(u=~u>>>0,f=~f>>>0,++f>4294967295&&(f=0,++u>4294967295&&(u=0))),new t(f,u)},t.from=function(o){if(typeof o=="number")return t.fromNumber(o);if(e.isString(o))if(e.Long)o=e.Long.fromString(o);else return t.fromNumber(parseInt(o,10));return o.low||o.high?new t(o.low>>>0,o.high>>>0):r},t.prototype.toNumber=function(o){if(!o&&this.hi>>>31){var a=~this.lo+1>>>0,f=~this.hi>>>0;return a||(f=f+1>>>0),-(a+f*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(o){return e.Long?new e.Long(this.lo|0,this.hi|0,!!o):{low:this.lo|0,high:this.hi|0,unsigned:!!o}};var i=String.prototype.charCodeAt;return t.fromHash=function(o){return o===s?r:new t((i.call(o,0)|i.call(o,1)<<8|i.call(o,2)<<16|i.call(o,3)<<24)>>>0,(i.call(o,4)|i.call(o,5)<<8|i.call(o,6)<<16|i.call(o,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var o=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^o)>>>0,this.lo=(this.lo<<1^o)>>>0,this},t.prototype.zzDecode=function(){var o=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^o)>>>0,this.hi=(this.hi>>>1^o)>>>0,this},t.prototype.length=function(){var o=this.lo,a=(this.lo>>>28|this.hi<<4)>>>0,f=this.hi>>>24;return f===0?a===0?o<16384?o<128?1:2:o<2097152?3:4:a<16384?a<128?5:6:a<2097152?7:8:f<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n},t.isString=function(n){return typeof n=="string"||n instanceof String},t.isObject=function(n){return n&&typeof n=="object"},t.isset=t.isSet=function(n,o){var a=n[o];return a!=null&&n.hasOwnProperty(o)?typeof a!="object"||(Array.isArray(a)?a.length:Object.keys(a).length)>0:!1},t.Buffer=function(){try{var i=t.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(n){return typeof n=="number"?t.Buffer?t._Buffer_allocUnsafe(n):new t.Array(n):t.Buffer?t._Buffer_from(n):typeof Uint8Array>"u"?n:new Uint8Array(n)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(n){return n?t.LongBits.from(n).toHash():t.LongBits.zeroHash},t.longFromHash=function(n,o){var a=t.LongBits.fromHash(n);return t.Long?t.Long.fromBits(a.lo,a.hi,o):a.toNumber(!!o)};function r(i,n,o){for(var a=Object.keys(n),f=0;f<a.length;++f)(i[a[f]]===void 0||!o)&&(i[a[f]]=n[a[f]]);return i}t.merge=r,t.lcFirst=function(n){return n.charAt(0).toLowerCase()+n.substring(1)};function s(i){function n(o,a){if(!(this instanceof n))return new n(o,a);Object.defineProperty(this,"message",{get:function(){return o}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:new Error().stack||""}),a&&r(this,a)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return i},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}t.newError=s,t.ProtocolError=s("ProtocolError"),t.oneOfGetter=function(n){for(var o={},a=0;a<n.length;++a)o[n[a]]=1;return function(){for(var f=Object.keys(this),u=f.length-1;u>-1;--u)if(o[f[u]]===1&&this[f[u]]!==void 0&&this[f[u]]!==null)return f[u]}},t.oneOfSetter=function(n){return function(o){for(var a=0;a<n.length;++a)n[a]!==o&&delete this[n[a]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var i=t.Buffer;if(!i){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=i.from!==Uint8Array.from&&i.from||function(o,a){return new i(o,a)},t._Buffer_allocUnsafe=i.allocUnsafe||function(o){return new i(o)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function e(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1(),Writer$1.alloc=function e(t){return new util$4.Array(t)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function e(t,r,s){return this.tail=this.tail.next=new Op(t,r,s),this.len+=r,this};function writeByte(e,t,r){t[r]=e&255}function writeVarint32(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function e(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},Writer$1.prototype.int32=function e(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)},Writer$1.prototype.sint32=function e(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(e,t,r){for(;e.hi;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}Writer$1.prototype.uint64=function e(t){var r=LongBits$1.from(t);return this._push(writeVarint64,r.length(),r)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function e(t){var r=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,r.length(),r)},Writer$1.prototype.bool=function e(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.prototype.fixed32=function e(t){return this._push(writeFixed32,4,t>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function e(t){var r=LongBits$1.from(t);return this._push(writeFixed32,4,r.lo)._push(writeFixed32,4,r.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function e(t){return this._push(util$4.float.writeFloatLE,4,t)},Writer$1.prototype.double=function e(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function e(t,r,s){r.set(t,s)}:function e(t,r,s){for(var i=0;i<t.length;++i)r[s+i]=t[i]};Writer$1.prototype.bytes=function e(t){var r=t.length>>>0;if(!r)return this._push(writeByte,1,0);if(util$4.isString(t)){var s=Writer$1.alloc(r=base64.length(t));base64.decode(t,s,0),t=s}return this.uint32(r)._push(writeBytes,r,t)},Writer$1.prototype.string=function e(t){var r=utf8$1.length(t);return r?this.uint32(r)._push(utf8$1.write,r,t):this._push(writeByte,1,0)},Writer$1.prototype.fork=function e(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function e(){var t=this.head,r=this.tail,s=this.len;return this.reset().uint32(s),s&&(this.tail.next=t.next,this.tail=r,this.len+=s),this},Writer$1.prototype.finish=function e(){for(var t=this.head.next,r=this.constructor.alloc(this.len),s=0;t;)t.fn(t.val,r,s),s+=t.len,t=t.next;return r},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,r,s){r.set(t,s)}:function(t,r,s){if(t.copy)t.copy(r,s,0,t.length);else for(var i=0;i<t.length;)r[s++]=t[i++]}},BufferWriter.prototype.bytes=function e(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this._push(BufferWriter.writeBytesBuffer,r,t),this};function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter.prototype.string=function e(t){var r=util$3.Buffer.byteLength(t);return this.uint32(r),r&&this._push(writeStringBuffer,r,t),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function e(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function e(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function e(){return util$2.Buffer?function(r){return(Reader$1.create=function(i){return util$2.Buffer.isBuffer(i)?new BufferReader$1(i):create_array(i)})(r)}:create_array};Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=function e(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}(),Reader$1.prototype.int32=function e(){return this.uint32()|0},Reader$1.prototype.sint32=function e(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var e=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Reader$1.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Reader$1.prototype.bytes=function e(){var t=this.uint32(),r=this.pos,s=this.pos+t;if(s>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(r,s);if(r===s){var i=util$2.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,s)},Reader$1.prototype.string=function e(){var t=this.bytes();return utf8.read(t,0,t.length)},Reader$1.prototype.skip=function e(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function e(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(e,t,r){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}Service.prototype.rpcCall=function e(t,r,s,i,n){if(!i)throw TypeError("request must be specified");var o=this;if(!n)return util.asPromise(e,o,t,r,s,i);if(!o.rpcImpl){setTimeout(function(){n(Error("already ended"))},0);return}try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(f,u){if(f)return o.emit("error",f,t),n(f);if(u===null){o.end(!0);return}if(!(u instanceof s))try{u=s[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return o.emit("error",l,t),n(l)}return o.emit("data",u,t),n(null,u)})}catch(a){o.emit("error",a,t),setTimeout(function(){n(a)},0);return}},Service.prototype.end=function e(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){var t=e;t.Service=service}(rpc);var roots={};(function(e){var t=e;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=r;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}r()})(indexMinimal);var minimal=indexMinimal,_m0=getDefaultExportFromCjs(minimal);function createBaseNodeConfig(){return{id:"",type:""}}const NodeConfig={encode(e,t=_m0.Writer.create()){return e.id!==""&&t.uint32(10).string(e.id),e.type!==""&&t.uint32(18).string(e.type),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let s=t===void 0?r.len:r.pos+t;const i=createBaseNodeConfig();for(;r.pos<s;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.id=r.string();continue;case 2:if(n!==18)break;i.type=r.string();continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{id:isSet(e.id)?globalThis.String(e.id):"",type:isSet(e.type)?globalThis.String(e.type):""}},toJSON(e){const t={};return e.id!==""&&(t.id=e.id),e.type!==""&&(t.type=e.type),t},create(e){return NodeConfig.fromPartial(e??{})},fromPartial(e){const t=createBaseNodeConfig();return t.id=e.id??"",t.type=e.type??"",t}};function createBaseEdge(){return{from:"",to:"",type:""}}const Edge={encode(e,t=_m0.Writer.create()){return e.from!==""&&t.uint32(10).string(e.from),e.to!==""&&t.uint32(18).string(e.to),e.type!==""&&t.uint32(26).string(e.type),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let s=t===void 0?r.len:r.pos+t;const i=createBaseEdge();for(;r.pos<s;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.from=r.string();continue;case 2:if(n!==18)break;i.to=r.string();continue;case 3:if(n!==26)break;i.type=r.string();continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{from:isSet(e.from)?globalThis.String(e.from):"",to:isSet(e.to)?globalThis.String(e.to):"",type:isSet(e.type)?globalThis.String(e.type):""}},toJSON(e){const t={};return e.from!==""&&(t.from=e.from),e.to!==""&&(t.to=e.to),e.type!==""&&(t.type=e.type),t},create(e){return Edge.fromPartial(e??{})},fromPartial(e){const t=createBaseEdge();return t.from=e.from??"",t.to=e.to??"",t.type=e.type??"",t}};function createBaseFlow(){return{nodes:[],edges:[]}}const Flow={encode(e,t=_m0.Writer.create()){for(const r of e.nodes)NodeConfig.encode(r,t.uint32(10).fork()).ldelim();for(const r of e.edges)Edge.encode(r,t.uint32(18).fork()).ldelim();return t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let s=t===void 0?r.len:r.pos+t;const i=createBaseFlow();for(;r.pos<s;){const n=r.uint32();switch(n>>>3){case 1:if(n!==10)break;i.nodes.push(NodeConfig.decode(r,r.uint32()));continue;case 2:if(n!==18)break;i.edges.push(Edge.decode(r,r.uint32()));continue}if((n&7)===4||n===0)break;r.skipType(n&7)}return i},fromJSON(e){return{nodes:globalThis.Array.isArray(e==null?void 0:e.nodes)?e.nodes.map(t=>NodeConfig.fromJSON(t)):[],edges:globalThis.Array.isArray(e==null?void 0:e.edges)?e.edges.map(t=>Edge.fromJSON(t)):[]}},toJSON(e){var r,s;const t={};return(r=e.nodes)!=null&&r.length&&(t.nodes=e.nodes.map(i=>NodeConfig.toJSON(i))),(s=e.edges)!=null&&s.length&&(t.edges=e.edges.map(i=>Edge.toJSON(i))),t},create(e){return Flow.fromPartial(e??{})},fromPartial(e){var r,s;const t=createBaseFlow();return t.nodes=((r=e.nodes)==null?void 0:r.map(i=>NodeConfig.fromPartial(i)))||[],t.edges=((s=e.edges)==null?void 0:s.map(i=>Edge.fromPartial(i)))||[],t}};function isSet(e){return e!=null}class BuildError extends Error{constructor(t,r,s,i){super(r),this.code=t,this.node=s,this.port=i}}function findNode(e,t){return e.nodes.find(r=>r.id===t)}function findPort(e,t,r){return(t==="in"?e.in:e.out).find(i=>i.port===r)}function validateMenus(e){for(const t of e.nodes)if(!Array.isArray(t.in)||!Array.isArray(t.out))throw new BuildError("E-CONFIG",`menus missing for node ${t.id}`,t.id)}function validateDangling(e){for(const t of e.edges){const[r,s]=t.from,[i,n]=t.to,o=findNode(e,r);if(!o)throw new BuildError("E-DANGLING",`missing node ${r}`,r);if(!findPort(o,"out",s))throw new BuildError("E-DANGLING",`missing port ${r}.${s}`,r,s);const f=findNode(e,i);if(!f)throw new BuildError("E-DANGLING",`missing node ${i}`,i);if(!findPort(f,"in",n))throw new BuildError("E-DANGLING",`missing port ${i}.${n}`,i,n)}}function validateTypes(e){for(const t of e.edges){const r=findNode(e,t.from[0]),s=findNode(e,t.to[0]),i=findPort(r,"out",t.from[1]),n=findPort(s,"in",t.to[1]);if(i.types.filter(a=>n.types.includes(a)).length===0)throw new BuildError("E-TYPE",`type mismatch ${t.from.join(".")} -> ${t.to.join(".")}`,t.from[0],t.from[1])}}function validateAcyclic(e){const t=new Map;for(const n of e.edges){const o=t.get(n.from[0])??[];o.push(n.to[0]),t.set(n.from[0],o)}const r=new Set,s=new Set;function i(n){if(s.has(n))throw new BuildError("E-CYCLE",`cycle detected at ${n}`,n);if(!r.has(n)){s.add(n);for(const o of t.get(n)??[])i(o);s.delete(n),r.add(n)}}for(const n of e.nodes)i(n.id)}function validateReachableOutputs(e){const t=new Set;for(const r of e.edges)t.add(`${r.from[0]}.${r.from[1]}`);for(const r of e.nodes)if(r.type!=="output")for(const s of r.out){const i=`${r.id}.${s.port}`;if(!t.has(i))throw new BuildError("E-UNREACHABLE-OUTPUT",`unreachable output ${i}`,r.id,s.port)}}function validateCanvas(e){validateMenus(e),validateDangling(e),validateTypes(e),validateAcyclic(e),validateReachableOutputs(e)}function getPort(e,t,r){return findPort(e,t,r)}function compile(e){validateCanvas(e);const t={nodes:e.nodes.map(r=>({id:r.id,type:r.type})),edges:e.edges.map(r=>{const s=e.nodes.find(f=>f.id===r.from[0]),i=e.nodes.find(f=>f.id===r.to[0]),n=getPort(s,"out",r.from[1]),o=getPort(i,"in",r.to[1]),a=n.types.find(f=>o.types.includes(f));if(!a)throw new BuildError("E-TYPE",`type mismatch ${r.from.join(".")} -> ${r.to.join(".")}`,r.from[0],r.from[1]);return{from:`${r.from[0]}.${r.from[1]}`,to:`${r.to[0]}.${r.to[1]}`,type:a}})};return Flow.encode(t).finish()}self.onmessage=e=>{try{const t=compile(e.data);self.postMessage({type:"success",bin:t},[t.buffer])}catch(t){self.postMessage({type:"error",message:t.message})}}})();

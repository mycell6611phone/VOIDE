var x=Object.defineProperty;var b=(e,t,r)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var w=(e,t,r)=>b(e,typeof t!="symbol"?t+"":t,r);(function(){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),o=0,n=2,i=!0;n<arguments.length;)r[o++]=arguments[n++];return new Promise(function(f,u){r[o]=function(c){if(i)if(i=!1,c)u(c);else{for(var l=new Array(arguments.length-1),d=0;d<l.length;)l[d++]=arguments[d];f.apply(null,l)}};try{e.apply(t||null,r)}catch(a){i&&(i=!1,u(a))}})}var base64$1={};(function(e){var t=e;t.length=function(f){var u=f.length;if(!u)return 0;for(var a=0;--u%4>1&&f.charAt(u)==="=";)++a;return Math.ceil(f.length*3)/4-a};for(var r=new Array(64),o=new Array(123),n=0;n<64;)o[r[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(f,u,a){for(var c=null,l=[],d=0,g=0,h;u<a;){var y=f[u++];switch(g){case 0:l[d++]=r[y>>2],h=(y&3)<<4,g=1;break;case 1:l[d++]=r[h|y>>4],h=(y&15)<<2,g=2;break;case 2:l[d++]=r[h|y>>6],l[d++]=r[y&63],g=0;break}d>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,l)),d=0)}return g&&(l[d++]=r[h],l[d++]=61,g===1&&(l[d++]=61)),c?(d&&c.push(String.fromCharCode.apply(String,l.slice(0,d))),c.join("")):String.fromCharCode.apply(String,l.slice(0,d))};var i="invalid encoding";t.decode=function(f,u,a){for(var c=a,l=0,d,g=0;g<f.length;){var h=f.charCodeAt(g++);if(h===61&&l>1)break;if((h=o[h])===void 0)throw Error(i);switch(l){case 0:d=h,l=1;break;case 1:u[a++]=d<<2|(h&48)>>4,d=h,l=2;break;case 2:u[a++]=(d&15)<<4|(h&60)>>2,d=h,l=3;break;case 3:u[a++]=(d&3)<<6|h,l=0;break}}if(l===1)throw Error(i);return a-c},t.test=function(f){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(f)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(t,r,o){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:r,ctx:o||this}),this},EventEmitter.prototype.off=function(t,r){if(t===void 0)this._listeners={};else if(r===void 0)this._listeners[t]=[];else for(var o=this._listeners[t],n=0;n<o.length;)o[n].fn===r?o.splice(n,1):++n;return this},EventEmitter.prototype.emit=function(t){var r=this._listeners[t];if(r){for(var o=[],n=1;n<arguments.length;)o.push(arguments[n++]);for(n=0;n<r.length;)r[n].fn.apply(r[n++].ctx,o)}return this};var float=factory(factory);function factory(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),o=r[3]===128;function n(u,a,c){t[0]=u,a[c]=r[0],a[c+1]=r[1],a[c+2]=r[2],a[c+3]=r[3]}function i(u,a,c){t[0]=u,a[c]=r[3],a[c+1]=r[2],a[c+2]=r[1],a[c+3]=r[0]}e.writeFloatLE=o?n:i,e.writeFloatBE=o?i:n;function s(u,a){return r[0]=u[a],r[1]=u[a+1],r[2]=u[a+2],r[3]=u[a+3],t[0]}function f(u,a){return r[3]=u[a],r[2]=u[a+1],r[1]=u[a+2],r[0]=u[a+3],t[0]}e.readFloatLE=o?s:f,e.readFloatBE=o?f:s}():function(){function t(o,n,i,s){var f=n<0?1:0;if(f&&(n=-n),n===0)o(1/n>0?0:2147483648,i,s);else if(isNaN(n))o(2143289344,i,s);else if(n>34028234663852886e22)o((f<<31|2139095040)>>>0,i,s);else if(n<11754943508222875e-54)o((f<<31|Math.round(n/1401298464324817e-60))>>>0,i,s);else{var u=Math.floor(Math.log(n)/Math.LN2),a=Math.round(n*Math.pow(2,-u)*8388608)&8388607;o((f<<31|u+127<<23|a)>>>0,i,s)}}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE);function r(o,n,i){var s=o(n,i),f=(s>>31)*2+1,u=s>>>23&255,a=s&8388607;return u===255?a?NaN:f*(1/0):u===0?f*1401298464324817e-60*a:f*Math.pow(2,u-150)*(a+8388608)}e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),o=r[7]===128;function n(u,a,c){t[0]=u,a[c]=r[0],a[c+1]=r[1],a[c+2]=r[2],a[c+3]=r[3],a[c+4]=r[4],a[c+5]=r[5],a[c+6]=r[6],a[c+7]=r[7]}function i(u,a,c){t[0]=u,a[c]=r[7],a[c+1]=r[6],a[c+2]=r[5],a[c+3]=r[4],a[c+4]=r[3],a[c+5]=r[2],a[c+6]=r[1],a[c+7]=r[0]}e.writeDoubleLE=o?n:i,e.writeDoubleBE=o?i:n;function s(u,a){return r[0]=u[a],r[1]=u[a+1],r[2]=u[a+2],r[3]=u[a+3],r[4]=u[a+4],r[5]=u[a+5],r[6]=u[a+6],r[7]=u[a+7],t[0]}function f(u,a){return r[7]=u[a],r[6]=u[a+1],r[5]=u[a+2],r[4]=u[a+3],r[3]=u[a+4],r[2]=u[a+5],r[1]=u[a+6],r[0]=u[a+7],t[0]}e.readDoubleLE=o?s:f,e.readDoubleBE=o?f:s}():function(){function t(o,n,i,s,f,u){var a=s<0?1:0;if(a&&(s=-s),s===0)o(0,f,u+n),o(1/s>0?0:2147483648,f,u+i);else if(isNaN(s))o(0,f,u+n),o(2146959360,f,u+i);else if(s>17976931348623157e292)o(0,f,u+n),o((a<<31|2146435072)>>>0,f,u+i);else{var c;if(s<22250738585072014e-324)c=s/5e-324,o(c>>>0,f,u+n),o((a<<31|c/4294967296)>>>0,f,u+i);else{var l=Math.floor(Math.log(s)/Math.LN2);l===1024&&(l=1023),c=s*Math.pow(2,-l),o(c*4503599627370496>>>0,f,u+n),o((a<<31|l+1023<<20|c*1048576&1048575)>>>0,f,u+i)}}}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0);function r(o,n,i,s,f){var u=o(s,f+n),a=o(s,f+i),c=(a>>31)*2+1,l=a>>>20&2047,d=4294967296*(a&1048575)+u;return l===2047?d?NaN:c*(1/0):l===0?c*5e-324*d:c*Math.pow(2,l-1075)*(d+4503599627370496)}e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=e&255}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};(function(e){var t=e;t.length=function(o){for(var n=0,i=0,s=0;s<o.length;++s)i=o.charCodeAt(s),i<128?n+=1:i<2048?n+=2:(i&64512)===55296&&(o.charCodeAt(s+1)&64512)===56320?(++s,n+=4):n+=3;return n},t.read=function(o,n,i){var s=i-n;if(s<1)return"";for(var f=null,u=[],a=0,c;n<i;)c=o[n++],c<128?u[a++]=c:c>191&&c<224?u[a++]=(c&31)<<6|o[n++]&63:c>239&&c<365?(c=((c&7)<<18|(o[n++]&63)<<12|(o[n++]&63)<<6|o[n++]&63)-65536,u[a++]=55296+(c>>10),u[a++]=56320+(c&1023)):u[a++]=(c&15)<<12|(o[n++]&63)<<6|o[n++]&63,a>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,u)),a=0);return f?(a&&f.push(String.fromCharCode.apply(String,u.slice(0,a))),f.join("")):String.fromCharCode.apply(String,u.slice(0,a))},t.write=function(o,n,i){for(var s=i,f,u,a=0;a<o.length;++a)f=o.charCodeAt(a),f<128?n[i++]=f:f<2048?(n[i++]=f>>6|192,n[i++]=f&63|128):(f&64512)===55296&&((u=o.charCodeAt(a+1))&64512)===56320?(f=65536+((f&1023)<<10)+(u&1023),++a,n[i++]=f>>18|240,n[i++]=f>>12&63|128,n[i++]=f>>6&63|128,n[i++]=f&63|128):(n[i++]=f>>12|224,n[i++]=f>>6&63|128,n[i++]=f&63|128);return i-s}})(utf8$2);var pool_1=pool;function pool(e,t,r){var o=r||8192,n=o>>>1,i=null,s=o;return function(u){if(u<1||u>n)return e(u);s+u>o&&(i=e(o),s=0);var a=t.call(i,s,s+=u);return s&7&&(s=(s|7)+1),a}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(i,s){this.lo=i>>>0,this.hi=s>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var o=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(s){if(s===0)return r;var f=s<0;f&&(s=-s);var u=s>>>0,a=(s-u)/4294967296>>>0;return f&&(a=~a>>>0,u=~u>>>0,++u>4294967295&&(u=0,++a>4294967295&&(a=0))),new t(u,a)},t.from=function(s){if(typeof s=="number")return t.fromNumber(s);if(e.isString(s))if(e.Long)s=e.Long.fromString(s);else return t.fromNumber(parseInt(s,10));return s.low||s.high?new t(s.low>>>0,s.high>>>0):r},t.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var f=~this.lo+1>>>0,u=~this.hi>>>0;return f||(u=u+1>>>0),-(f+u*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(s){return e.Long?new e.Long(this.lo|0,this.hi|0,!!s):{low:this.lo|0,high:this.hi|0,unsigned:!!s}};var n=String.prototype.charCodeAt;return t.fromHash=function(s){return s===o?r:new t((n.call(s,0)|n.call(s,1)<<8|n.call(s,2)<<16|n.call(s,3)<<24)>>>0,(n.call(s,4)|n.call(s,5)<<8|n.call(s,6)<<16|n.call(s,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},t.prototype.zzDecode=function(){var s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},t.prototype.length=function(){var s=this.lo,f=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?f===0?s<16384?s<128?1:2:s<2097152?3:4:f<16384?f<128?5:6:f<2097152?7:8:u<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i},t.isString=function(i){return typeof i=="string"||i instanceof String},t.isObject=function(i){return i&&typeof i=="object"},t.isset=t.isSet=function(i,s){var f=i[s];return f!=null&&i.hasOwnProperty(s)?typeof f!="object"||(Array.isArray(f)?f.length:Object.keys(f).length)>0:!1},t.Buffer=function(){try{var n=t.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(i){return typeof i=="number"?t.Buffer?t._Buffer_allocUnsafe(i):new t.Array(i):t.Buffer?t._Buffer_from(i):typeof Uint8Array>"u"?i:new Uint8Array(i)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(i){return i?t.LongBits.from(i).toHash():t.LongBits.zeroHash},t.longFromHash=function(i,s){var f=t.LongBits.fromHash(i);return t.Long?t.Long.fromBits(f.lo,f.hi,s):f.toNumber(!!s)};function r(n,i,s){for(var f=Object.keys(i),u=0;u<f.length;++u)(n[f[u]]===void 0||!s)&&(n[f[u]]=i[f[u]]);return n}t.merge=r,t.lcFirst=function(i){return i.charAt(0).toLowerCase()+i.substring(1)};function o(n){function i(s,f){if(!(this instanceof i))return new i(s,f);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:new Error().stack||""}),f&&r(this,f)}return i.prototype=Object.create(Error.prototype,{constructor:{value:i,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),i}t.newError=o,t.ProtocolError=o("ProtocolError"),t.oneOfGetter=function(i){for(var s={},f=0;f<i.length;++f)s[i[f]]=1;return function(){for(var u=Object.keys(this),a=u.length-1;a>-1;--a)if(s[u[a]]===1&&this[u[a]]!==void 0&&this[u[a]]!==null)return u[a]}},t.oneOfSetter=function(i){return function(s){for(var f=0;f<i.length;++f)i[f]!==s&&delete this[i[f]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var n=t.Buffer;if(!n){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=n.from!==Uint8Array.from&&n.from||function(s,f){return new n(s,f)},t._Buffer_allocUnsafe=n.allocUnsafe||function(s){return new n(s)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function e(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1(),Writer$1.alloc=function e(t){return new util$4.Array(t)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function e(t,r,o){return this.tail=this.tail.next=new Op(t,r,o),this.len+=r,this};function writeByte(e,t,r){t[r]=e&255}function writeVarint32(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function e(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},Writer$1.prototype.int32=function e(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)},Writer$1.prototype.sint32=function e(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(e,t,r){for(;e.hi;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}Writer$1.prototype.uint64=function e(t){var r=LongBits$1.from(t);return this._push(writeVarint64,r.length(),r)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function e(t){var r=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,r.length(),r)},Writer$1.prototype.bool=function e(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.prototype.fixed32=function e(t){return this._push(writeFixed32,4,t>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function e(t){var r=LongBits$1.from(t);return this._push(writeFixed32,4,r.lo)._push(writeFixed32,4,r.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function e(t){return this._push(util$4.float.writeFloatLE,4,t)},Writer$1.prototype.double=function e(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function e(t,r,o){r.set(t,o)}:function e(t,r,o){for(var n=0;n<t.length;++n)r[o+n]=t[n]};Writer$1.prototype.bytes=function e(t){var r=t.length>>>0;if(!r)return this._push(writeByte,1,0);if(util$4.isString(t)){var o=Writer$1.alloc(r=base64.length(t));base64.decode(t,o,0),t=o}return this.uint32(r)._push(writeBytes,r,t)},Writer$1.prototype.string=function e(t){var r=utf8$1.length(t);return r?this.uint32(r)._push(utf8$1.write,r,t):this._push(writeByte,1,0)},Writer$1.prototype.fork=function e(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function e(){var t=this.head,r=this.tail,o=this.len;return this.reset().uint32(o),o&&(this.tail.next=t.next,this.tail=r,this.len+=o),this},Writer$1.prototype.finish=function e(){for(var t=this.head.next,r=this.constructor.alloc(this.len),o=0;t;)t.fn(t.val,r,o),o+=t.len,t=t.next;return r},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,r,o){r.set(t,o)}:function(t,r,o){if(t.copy)t.copy(r,o,0,t.length);else for(var n=0;n<t.length;)r[o++]=t[n++]}},BufferWriter.prototype.bytes=function e(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this._push(BufferWriter.writeBytesBuffer,r,t),this};function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter.prototype.string=function e(t){var r=util$3.Buffer.byteLength(t);return this.uint32(r),r&&this._push(writeStringBuffer,r,t),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function e(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function e(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function e(){return util$2.Buffer?function(r){return(Reader$1.create=function(n){return util$2.Buffer.isBuffer(n)?new BufferReader$1(n):create_array(n)})(r)}:create_array};Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=function e(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}(),Reader$1.prototype.int32=function e(){return this.uint32()|0},Reader$1.prototype.sint32=function e(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var e=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Reader$1.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Reader$1.prototype.bytes=function e(){var t=this.uint32(),r=this.pos,o=this.pos+t;if(o>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(r,o);if(r===o){var n=util$2.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,o)},Reader$1.prototype.string=function e(){var t=this.bytes();return utf8.read(t,0,t.length)},Reader$1.prototype.skip=function e(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function e(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(e,t,r){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}Service.prototype.rpcCall=function e(t,r,o,n,i){if(!n)throw TypeError("request must be specified");var s=this;if(!i)return util.asPromise(e,s,t,r,o,n);if(!s.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(u,a){if(u)return s.emit("error",u,t),i(u);if(a===null){s.end(!0);return}if(!(a instanceof o))try{a=o[s.responseDelimited?"decodeDelimited":"decode"](a)}catch(c){return s.emit("error",c,t),i(c)}return s.emit("data",a,t),i(null,a)})}catch(f){s.emit("error",f,t),setTimeout(function(){i(f)},0);return}},Service.prototype.end=function e(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){var t=e;t.Service=service}(rpc);var roots={};(function(e){var t=e;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=r;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}r()})(indexMinimal);var minimal=indexMinimal,_m0=getDefaultExportFromCjs(minimal);function createBaseUserText(){return{text:""}}const UserText={encode(e,t=_m0.Writer.create()){return e.text!==""&&t.uint32(10).string(e.text),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const n=createBaseUserText();for(;r.pos<o;){const i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;n.text=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return n},fromJSON(e){return{text:isSet(e.text)?globalThis.String(e.text):""}},toJSON(e){const t={};return e.text!==""&&(t.text=e.text),t},create(e){return UserText.fromPartial(e??{})},fromPartial(e){const t=createBaseUserText();return t.text=e.text??"",t}};function createBasePromptText(){return{text:""}}const PromptText={encode(e,t=_m0.Writer.create()){return e.text!==""&&t.uint32(10).string(e.text),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const n=createBasePromptText();for(;r.pos<o;){const i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;n.text=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return n},fromJSON(e){return{text:isSet(e.text)?globalThis.String(e.text):""}},toJSON(e){const t={};return e.text!==""&&(t.text=e.text),t},create(e){return PromptText.fromPartial(e??{})},fromPartial(e){const t=createBasePromptText();return t.text=e.text??"",t}};function createBaseLLMText(){return{text:""}}const LLMText={encode(e,t=_m0.Writer.create()){return e.text!==""&&t.uint32(10).string(e.text),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const n=createBaseLLMText();for(;r.pos<o;){const i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;n.text=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return n},fromJSON(e){return{text:isSet(e.text)?globalThis.String(e.text):""}},toJSON(e){const t={};return e.text!==""&&(t.text=e.text),t},create(e){return LLMText.fromPartial(e??{})},fromPartial(e){const t=createBaseLLMText();return t.text=e.text??"",t}};function createBaseAnyBlob(){return{data:new Uint8Array(0)}}const AnyBlob={encode(e,t=_m0.Writer.create()){return e.data.length!==0&&t.uint32(10).bytes(e.data),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const n=createBaseAnyBlob();for(;r.pos<o;){const i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;n.data=r.bytes();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return n},fromJSON(e){return{data:isSet(e.data)?bytesFromBase64(e.data):new Uint8Array(0)}},toJSON(e){const t={};return e.data.length!==0&&(t.data=base64FromBytes(e.data)),t},create(e){return AnyBlob.fromPartial(e??{})},fromPartial(e){const t=createBaseAnyBlob();return t.data=e.data??new Uint8Array(0),t}};function createBaseNodeConfig(){return{id:"",type:""}}const NodeConfig={encode(e,t=_m0.Writer.create()){return e.id!==""&&t.uint32(10).string(e.id),e.type!==""&&t.uint32(18).string(e.type),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const n=createBaseNodeConfig();for(;r.pos<o;){const i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;n.id=r.string();continue;case 2:if(i!==18)break;n.type=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return n},fromJSON(e){return{id:isSet(e.id)?globalThis.String(e.id):"",type:isSet(e.type)?globalThis.String(e.type):""}},toJSON(e){const t={};return e.id!==""&&(t.id=e.id),e.type!==""&&(t.type=e.type),t},create(e){return NodeConfig.fromPartial(e??{})},fromPartial(e){const t=createBaseNodeConfig();return t.id=e.id??"",t.type=e.type??"",t}};function createBaseEdge(){return{from:"",to:"",type:""}}const Edge={encode(e,t=_m0.Writer.create()){return e.from!==""&&t.uint32(10).string(e.from),e.to!==""&&t.uint32(18).string(e.to),e.type!==""&&t.uint32(26).string(e.type),t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const n=createBaseEdge();for(;r.pos<o;){const i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;n.from=r.string();continue;case 2:if(i!==18)break;n.to=r.string();continue;case 3:if(i!==26)break;n.type=r.string();continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return n},fromJSON(e){return{from:isSet(e.from)?globalThis.String(e.from):"",to:isSet(e.to)?globalThis.String(e.to):"",type:isSet(e.type)?globalThis.String(e.type):""}},toJSON(e){const t={};return e.from!==""&&(t.from=e.from),e.to!==""&&(t.to=e.to),e.type!==""&&(t.type=e.type),t},create(e){return Edge.fromPartial(e??{})},fromPartial(e){const t=createBaseEdge();return t.from=e.from??"",t.to=e.to??"",t.type=e.type??"",t}};function createBaseFlow(){return{nodes:[],edges:[]}}const Flow={encode(e,t=_m0.Writer.create()){for(const r of e.nodes)NodeConfig.encode(r,t.uint32(10).fork()).ldelim();for(const r of e.edges)Edge.encode(r,t.uint32(18).fork()).ldelim();return t},decode(e,t){const r=e instanceof _m0.Reader?e:_m0.Reader.create(e);let o=t===void 0?r.len:r.pos+t;const n=createBaseFlow();for(;r.pos<o;){const i=r.uint32();switch(i>>>3){case 1:if(i!==10)break;n.nodes.push(NodeConfig.decode(r,r.uint32()));continue;case 2:if(i!==18)break;n.edges.push(Edge.decode(r,r.uint32()));continue}if((i&7)===4||i===0)break;r.skipType(i&7)}return n},fromJSON(e){return{nodes:globalThis.Array.isArray(e==null?void 0:e.nodes)?e.nodes.map(t=>NodeConfig.fromJSON(t)):[],edges:globalThis.Array.isArray(e==null?void 0:e.edges)?e.edges.map(t=>Edge.fromJSON(t)):[]}},toJSON(e){var r,o;const t={};return(r=e.nodes)!=null&&r.length&&(t.nodes=e.nodes.map(n=>NodeConfig.toJSON(n))),(o=e.edges)!=null&&o.length&&(t.edges=e.edges.map(n=>Edge.toJSON(n))),t},create(e){return Flow.fromPartial(e??{})},fromPartial(e){var r,o;const t=createBaseFlow();return t.nodes=((r=e.nodes)==null?void 0:r.map(n=>NodeConfig.fromPartial(n)))||[],t.edges=((o=e.edges)==null?void 0:o.map(n=>Edge.fromPartial(n)))||[],t}};function bytesFromBase64(e){if(globalThis.Buffer)return Uint8Array.from(globalThis.Buffer.from(e,"base64"));{const t=globalThis.atob(e),r=new Uint8Array(t.length);for(let o=0;o<t.length;++o)r[o]=t.charCodeAt(o);return r}}function base64FromBytes(e){if(globalThis.Buffer)return globalThis.Buffer.from(e).toString("base64");{const t=[];return e.forEach(r=>{t.push(globalThis.String.fromCharCode(r))}),globalThis.btoa(t.join(""))}}function isSet(e){return e!=null}function makeProtoCodec(e){return{encode(t){return e.encode(t).finish()},decode(t){return e.decode(t)}}}const anyBlobCodec=makeProtoCodec(AnyBlob);class TypeRegistry{constructor(){w(this,"codecs",new Map);this.codecs.set("UserText",makeProtoCodec(UserText)),this.codecs.set("PromptText",makeProtoCodec(PromptText)),this.codecs.set("LLMText",makeProtoCodec(LLMText)),this.codecs.set("AnyBlob",anyBlobCodec)}register(t,r){this.codecs.set(t,r)}resolve(t){const r=this.codecs.get(t);if(r)return r;if(t.startsWith("ext:")){const o=this.codecs.get("AnyBlob");if(o)return o}throw new Error(`Unknown type: ${t}`)}encode(t,r){return this.resolve(t).encode(r)}decode(t,r){return this.resolve(t).decode(r)}}const globalTypeRegistry=new TypeRegistry;function sampleValue(e){switch(e){case"UserText":case"PromptText":case"LLMText":return{text:""};case"AnyBlob":return{data:new Uint8Array};default:if(e.startsWith("ext:"))return{data:new Uint8Array};throw new Error(`Unknown type: ${e}`)}}class NodeRegistry{constructor(){w(this,"handlers",new Map)}register(t){for(const r of[...Object.values(t.inPorts),...Object.values(t.outPorts)]){const o=sampleValue(r);globalTypeRegistry.encode(r,o)}this.handlers.set(t.kind,t)}get(t){const r=this.handlers.get(t);if(!r)throw new Error(`Unknown handler kind: ${t}`);return r}}function makeContext(e){return{inputs:{},outputs:{},log:e}}const DEFAULT_TIMEOUT_MS=5e3,DEFAULT_RETRIES=0;function parseEdge(e){const[t,r]=e.from.split("."),[o,n]=e.to.split(".");return{fromNode:t,fromPort:r,toNode:o,toPort:n,type:e.type,mailbox:[]}}function nodeConfig(e){switch(e.type){case"InputNode":return{id:e.id};case"OutputNode":return{name:e.id};case"LogNode":return{name:e.id};case"LLMNode":return{model:"stub"};default:return{}}}async function withTimeout(e,t){return Promise.race([e,new Promise((r,o)=>setTimeout(()=>o(new Error("timeout")),t))])}async function*orchestrate(e,t,r,o={}){const n=Flow.decode(e),i=makeContext();i.inputs=t??{};const s=new Map(n.nodes.map(l=>[l.id,l])),f=new Map,u=new Map;for(const l of n.edges.map(parseEdge)){const d=u.get(l.fromNode)??[];d.push(l),u.set(l.fromNode,d);const g=f.get(l.toNode)??[];g.push(l),f.set(l.toNode,g)}const a=[];for(const l of n.nodes)(f.get(l.id)??[]).length===0&&a.push(l.id);const c=new Set;for(;a.length>0;){const l=a.shift();if(c.has(l))continue;c.add(l);const d=s.get(l),g=r.get(d.type),h={};for(const p of f.get(l)??[])h[p.toPort]=p.mailbox.shift();yield{type:"NODE_START",nodeId:l};let y,_=0;for(;;)try{y=await withTimeout(g.execute({config:nodeConfig(d),inputs:h,context:i,providers:o}),DEFAULT_TIMEOUT_MS);break}catch(p){if(_++,_>DEFAULT_RETRIES){const m=p instanceof Error?p:new Error(String(p));throw yield{type:"NODE_ERROR",nodeId:l,error:m},m}}yield{type:"NODE_END",nodeId:l};for(const p of u.get(l)??[]){const m=y[p.fromPort];m!==void 0&&(p.mailbox.push(m),yield{type:"EDGE_EMIT",from:`${p.fromNode}.${p.fromPort}`,to:`${p.toNode}.${p.toPort}`}),(f.get(p.toNode)??[]).every(B=>B.mailbox.length>0)&&!c.has(p.toNode)&&!a.includes(p.toNode)&&a.push(p.toNode)}}return{outputs:i.outputs}}const InputNode={kind:"InputNode",inPorts:{},outPorts:{text:"UserText"},async execute({config:e,context:t}){const r=t.inputs[e.id]??"";return{text:{text:String(r)}}}},PromptNode={kind:"PromptNode",inPorts:{text:"UserText"},outPorts:{prompt:"PromptText"},async execute({inputs:e}){var i;const t="{{text}}",r=((i=e.text)==null?void 0:i.text)??"";return{prompt:{text:t.replace(/{{\s*text\s*}}/g,escape(String(r)))}}}};function escape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}const LLMNode={kind:"LLMNode",inPorts:{prompt:"PromptText"},outPorts:{text:"LLMText"},async execute({inputs:e,config:t,providers:r}){var f;const o=r==null?void 0:r[t.model];if(!o)throw new Error(`Unknown provider: ${t.model}`);const n=((f=e.prompt)==null?void 0:f.text)??"";return{text:{text:await o.generate(n)}}}};class StubProvider{async generate(t){return t.toLowerCase().includes("bullet")?`- one
- two`:t}}const BranchNode={kind:"BranchNode",inPorts:{text:"LLMText"},outPorts:{pass:"LLMText",fail:"LLMText"},async execute({inputs:e,config:t}){const r=e.text;return r.text.includes(t.condition)?{pass:r}:{fail:r}}},LogNode={kind:"LogNode",inPorts:{value:"AnyBlob"},outPorts:{value:"AnyBlob"},async execute({inputs:e,config:t,context:r}){var o;return(o=r.log)==null||o.call(r,`${t.name}:`,e.value),{value:e.value}}},OutputNode={kind:"OutputNode",inPorts:{text:"LLMText"},outPorts:{},async execute({inputs:e,config:t,context:r}){var o;return r.outputs[t.name]=((o=e.text)==null?void 0:o.text)??"",{}}};function registerBuiltins(e){e.register(InputNode),e.register(PromptNode),e.register(LLMNode),e.register(BranchNode),e.register(LogNode),e.register(OutputNode)}self.onmessage=async e=>{const t=new NodeRegistry;registerBuiltins(t);const r={stub:new StubProvider},o=orchestrate(e.data.flowBin,{},t,r);for(;;){const{value:n,done:i}=await o.next();if(i){self.postMessage({type:"done",result:n});break}else self.postMessage(n)}}})();

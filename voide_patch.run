#!/usr/bin/env bash
set -euo pipefail

# Self-extracting VOIDE patch. Extracts into the current directory.
command -v tar >/dev/null 2>&1 || { echo "tar required"; exit 1; }
command -v base64 >/dev/null 2>&1 || { echo "base64 required"; exit 1; }

DEC_FLAG="--decode"
if ! base64 --help 2>&1 | grep -q -- '--decode'; then DEC_FLAG="-d"; fi

ARCHIVE_MARK="__VOIDE_ARCHIVE_BELOW__"

# Verify optional expected SHA256 of payload after decode
EXPECTED_SHA="64f4d0d03216c2e28dd46be5186edc44eb1b89c63b0df400d9792f2e06240cac"

PAYLOAD=$(awk 'BEGIN{p=0} /^'${ARCHIVE_MARK}'$/ {p=1; next} p {print}' "$0")
ACTUAL_SHA=$(printf "%s" "$PAYLOAD" | base64 $DEC_FLAG | sha256sum | awk '{print $1}' || true)

if [ -n "$ACTUAL_SHA" ] && [ -n "$EXPECTED_SHA" ] && [ "$ACTUAL_SHA" != "$EXPECTED_SHA" ]; then
  echo "warning: payload sha256 mismatch (expected $EXPECTED_SHA got $ACTUAL_SHA)"
fi

printf "%s" "$PAYLOAD" | base64 $DEC_FLAG | tar -xz --no-same-owner --no-same-permissions -C .

echo "VOIDE patch extracted."
exit 0
__VOIDE_ARCHIVE_BELOW__
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
